import { useState } from "react";
import { Link } from "react-router-dom";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { Textarea } from "@/components/ui/textarea";
import { 
  ArrowLeft, 
  CheckCircle, 
  X, 
  Eye, 
  ExternalLink,\n  Calendar,\n  DollarSign,\n  User,\n  AlertTriangle\n} from \"lucide-react\";

interface EvidenceSubmission {\n  id: string;\n  campaignId: string;\n  campaignTitle: string;\n  influencerName: string;\n  influencerAvatar: string;\n  influencerHandle: string;\n  amount: number;\n  submittedAt: string;\n  evidence: {\n    screenshots: string[];\n    links: string[];\n    description: string;\n  };\n  status: 'pending' | 'approved' | 'rejected';\n}\n\nexport default function EvidenceReview() {\n  const [selectedSubmission, setSelectedSubmission] = useState<EvidenceSubmission | null>(null);\n  const [reviewNotes, setReviewNotes] = useState('');\n\n  const [submissions] = useState<EvidenceSubmission[]>([\n    {\n      id: '1',\n      campaignId: '3',\n      campaignTitle: 'Fitness Supplement Review',\n      influencerName: 'Emma Wellness',\n      influencerAvatar: '/placeholder.svg',\n      influencerHandle: '@emmawellness',\n      amount: 450,\n      submittedAt: '2024-01-20',\n      evidence: {\n        screenshots: ['/placeholder.svg', '/placeholder.svg'],\n        links: ['https://instagram.com/p/example123', 'https://instagram.com/stories/highlights/123'],\n        description: 'Posted on my main feed with authentic review. Received great engagement from my fitness community. The post shows me using the product during my morning routine and includes honest feedback about taste and effectiveness.'\n      },\n      status: 'pending'\n    },\n    {\n      id: '2',\n      campaignId: '2',\n      campaignTitle: 'Product Review Video',\n      influencerName: 'Mike Strong',\n      influencerAvatar: '/placeholder.svg',\n      influencerHandle: '@mikestrong',\n      amount: 1200,\n      submittedAt: '2024-01-19',\n      evidence: {\n        screenshots: ['/placeholder.svg'],\n        links: ['https://instagram.com/p/video-review-456'],\n        description: 'Created a comprehensive 90-second unboxing and review video. Highlighted all key features as requested and showed genuine reactions. Video has already received 2.5K views and 300+ likes with positive comments about the product.'\n      },\n      status: 'approved'\n    }\n  ]);\n\n  const handleApprove = (submissionId: string) => {\n    // Handle approval logic here\n    console.log('Approved submission:', submissionId);\n    setSelectedSubmission(null);\n    setReviewNotes('');\n  };\n\n  const handleReject = (submissionId: string) => {\n    // Handle rejection logic here\n    console.log('Rejected submission:', submissionId, 'Notes:', reviewNotes);\n    setSelectedSubmission(null);\n    setReviewNotes('');\n  };\n\n  const pendingSubmissions = submissions.filter(sub => sub.status === 'pending');\n  const reviewedSubmissions = submissions.filter(sub => sub.status !== 'pending');\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white border-b border-gray-200\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center\">\n              <Link to=\"/\" className=\"flex items-center gap-2\">\n                <div className=\"w-8 h-8 bg-gradient-to-br from-brand-500 to-gradient-to rounded-lg flex items-center justify-center\">\n                  <span className=\"text-white font-bold text-lg\">E</span>\n                </div>\n                <span className=\"text-xl font-bold text-gray-900\">Echo</span>\n              </Link>\n              <nav className=\"hidden md:flex ml-8 space-x-8\">\n                <a href=\"#\" className=\"text-brand-600 border-b-2 border-brand-600 pb-4 text-sm font-medium\">\n                  Evidence Review\n                </a>\n              </nav>\n            </div>\n            <Link to=\"/business-dashboard\">\n              <Button variant=\"ghost\" className=\"flex items-center gap-2\">\n                <ArrowLeft className=\"h-4 w-4\" />\n                Back to Dashboard\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900\">Evidence Review</h1>\n          <p className=\"text-gray-600 mt-2\">Review and approve influencer campaign submissions</p>\n        </div>\n\n        {/* Stats */}\n        <div className=\"grid md:grid-cols-3 gap-6 mb-8\">\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center\">\n                <div className=\"flex-shrink-0\">\n                  <div className=\"w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center\">\n                    <AlertTriangle className=\"h-6 w-6 text-yellow-600\" />\n                  </div>\n                </div>\n                <div className=\"ml-4\">\n                  <div className=\"text-sm font-medium text-gray-500\">Pending Review</div>\n                  <div className=\"text-2xl font-bold text-gray-900\">{pendingSubmissions.length}</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center\">\n                <div className=\"flex-shrink-0\">\n                  <div className=\"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center\">\n                    <CheckCircle className=\"h-6 w-6 text-green-600\" />\n                  </div>\n                </div>\n                <div className=\"ml-4\">\n                  <div className=\"text-sm font-medium text-gray-500\">Approved</div>\n                  <div className=\"text-2xl font-bold text-gray-900\">{reviewedSubmissions.filter(s => s.status === 'approved').length}</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center\">\n                <div className=\"flex-shrink-0\">\n                  <div className=\"w-12 h-12 bg-brand-100 rounded-lg flex items-center justify-center\">\n                    <DollarSign className=\"h-6 w-6 text-brand-600\" />\n                  </div>\n                </div>\n                <div className=\"ml-4\">\n                  <div className=\"text-sm font-medium text-gray-500\">Pending Payout</div>\n                  <div className=\"text-2xl font-bold text-gray-900\">\n                    ${reviewedSubmissions.filter(s => s.status === 'approved').reduce((sum, s) => sum + s.amount, 0).toLocaleString()}\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Pending Submissions */}\n        {pendingSubmissions.length > 0 && (\n          <div className=\"mb-8\">\n            <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">Pending Reviews</h2>\n            <div className=\"space-y-4\">\n              {pendingSubmissions.map((submission) => (\n                <Card key={submission.id} className=\"hover:shadow-lg transition-shadow\">\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center justify-between mb-4\">\n                      <div className=\"flex items-center gap-4\">\n                        <Avatar className=\"h-12 w-12\">\n                          <AvatarImage src={submission.influencerAvatar} />\n                          <AvatarFallback>{submission.influencerName.charAt(0)}</AvatarFallback>\n                        </Avatar>\n                        <div>\n                          <h3 className=\"text-lg font-semibold text-gray-900\">{submission.campaignTitle}</h3>\n                          <p className=\"text-sm text-gray-600\">{submission.influencerName} ({submission.influencerHandle})</p>\n                        </div>\n                      </div>\n                      <div className=\"text-right\">\n                        <div className=\"text-xl font-bold text-green-600\">${submission.amount}</div>\n                        <Badge className=\"bg-yellow-100 text-yellow-800 hover:bg-yellow-100\">\n                          <AlertTriangle className=\"h-3 w-3 mr-1\" />\n                          Pending Review\n                        </Badge>\n                      </div>\n                    </div>\n\n                    <div className=\"mb-4\">\n                      <h4 className=\"font-medium text-gray-900 mb-2\">Submission Description</h4>\n                      <p className=\"text-gray-600 text-sm\">{submission.evidence.description}</p>\n                    </div>\n\n                    <div className=\"grid md:grid-cols-2 gap-4 mb-4\">\n                      <div>\n                        <h5 className=\"font-medium text-gray-700 mb-2\">Screenshots ({submission.evidence.screenshots.length})</h5>\n                        <div className=\"flex gap-2\">\n                          {submission.evidence.screenshots.map((screenshot, index) => (\n                            <div key={index} className=\"w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center\">\n                              <Eye className=\"h-4 w-4 text-gray-400\" />\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                      <div>\n                        <h5 className=\"font-medium text-gray-700 mb-2\">Post Links</h5>\n                        <div className=\"space-y-1\">\n                          {submission.evidence.links.map((link, index) => (\n                            <a \n                              key={index} \n                              href={link} \n                              target=\"_blank\" \n                              rel=\"noopener noreferrer\"\n                              className=\"flex items-center gap-2 text-sm text-brand-600 hover:text-brand-700\"\n                            >\n                              <ExternalLink className=\"h-3 w-3\" />\n                              View Post {index + 1}\n                            </a>\n                          ))}\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"flex items-center justify-between text-sm text-gray-500 mb-4\">\n                      <span className=\"flex items-center gap-1\">\n                        <Calendar className=\"h-4 w-4\" />\n                        Submitted {new Date(submission.submittedAt).toLocaleDateString()}\n                      </span>\n                    </div>\n\n                    <div className=\"flex gap-3\">\n                      <Button \n                        onClick={() => setSelectedSubmission(submission)}\n                        className=\"flex-1 bg-brand-600 hover:bg-brand-700 text-white\"\n                      >\n                        <Eye className=\"h-4 w-4 mr-2\" />\n                        Review in Detail\n                      </Button>\n                      <Button \n                        onClick={() => handleApprove(submission.id)}\n                        className=\"bg-green-600 hover:bg-green-700 text-white px-6\"\n                      >\n                        <CheckCircle className=\"h-4 w-4 mr-2\" />\n                        Quick Approve\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Reviewed Submissions */}\n        {reviewedSubmissions.length > 0 && (\n          <div>\n            <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">Recently Reviewed</h2>\n            <div className=\"space-y-4\">\n              {reviewedSubmissions.map((submission) => (\n                <Card key={submission.id}>\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-4\">\n                        <Avatar className=\"h-10 w-10\">\n                          <AvatarImage src={submission.influencerAvatar} />\n                          <AvatarFallback>{submission.influencerName.charAt(0)}</AvatarFallback>\n                        </Avatar>\n                        <div>\n                          <h3 className=\"font-semibold text-gray-900\">{submission.campaignTitle}</h3>\n                          <p className=\"text-sm text-gray-600\">{submission.influencerName}</p>\n                        </div>\n                      </div>\n                      <div className=\"text-right\">\n                        <div className=\"font-bold text-gray-900\">${submission.amount}</div>\n                        <Badge \n                          className={\n                            submission.status === 'approved'\n                              ? 'bg-green-100 text-green-800 hover:bg-green-100'\n                              : 'bg-red-100 text-red-800 hover:bg-red-100'\n                          }\n                        >\n                          {submission.status === 'approved' && <CheckCircle className=\"h-3 w-3 mr-1\" />}\n                          {submission.status === 'rejected' && <X className=\"h-3 w-3 mr-1\" />}\n                          {submission.status === 'approved' ? 'Approved' : 'Rejected'}\n                        </Badge>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Detailed Review Modal */}\n      {selectedSubmission && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n          <Card className=\"w-full max-w-4xl max-h-[90vh] overflow-y-auto\">\n            <CardHeader>\n              <CardTitle>Review Evidence: {selectedSubmission.campaignTitle}</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"grid md:grid-cols-2 gap-6\">\n                <div>\n                  <h4 className=\"font-semibold text-gray-900 mb-3\">Influencer Details</h4>\n                  <div className=\"flex items-center gap-3 mb-4\">\n                    <Avatar className=\"h-12 w-12\">\n                      <AvatarImage src={selectedSubmission.influencerAvatar} />\n                      <AvatarFallback>{selectedSubmission.influencerName.charAt(0)}</AvatarFallback>\n                    </Avatar>\n                    <div>\n                      <h5 className=\"font-medium text-gray-900\">{selectedSubmission.influencerName}</h5>\n                      <p className=\"text-sm text-gray-600\">{selectedSubmission.influencerHandle}</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Campaign:</span>\n                      <span className=\"font-medium\">{selectedSubmission.campaignTitle}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Amount:</span>\n                      <span className=\"font-medium text-green-600\">${selectedSubmission.amount}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Submitted:</span>\n                      <span className=\"font-medium\">{new Date(selectedSubmission.submittedAt).toLocaleDateString()}</span>\n                    </div>\n                  </div>\n                </div>\n\n                <div>\n                  <h4 className=\"font-semibold text-gray-900 mb-3\">Evidence Links</h4>\n                  <div className=\"space-y-2\">\n                    {selectedSubmission.evidence.links.map((link, index) => (\n                      <a \n                        key={index}\n                        href={link}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        className=\"flex items-center gap-2 p-2 border border-gray-200 rounded-lg hover:bg-gray-50 text-sm\"\n                      >\n                        <ExternalLink className=\"h-4 w-4 text-brand-600\" />\n                        <span className=\"text-brand-600 hover:text-brand-700\">Post {index + 1}</span>\n                      </a>\n                    ))}\n                  </div>\n                </div>\n              </div>\n\n              <div>\n                <h4 className=\"font-semibold text-gray-900 mb-3\">Submission Description</h4>\n                <div className=\"bg-gray-50 p-4 rounded-lg\">\n                  <p className=\"text-gray-700\">{selectedSubmission.evidence.description}</p>\n                </div>\n              </div>\n\n              <div>\n                <h4 className=\"font-semibold text-gray-900 mb-3\">Screenshots</h4>\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                  {selectedSubmission.evidence.screenshots.map((screenshot, index) => (\n                    <div key={index} className=\"aspect-square bg-gray-200 rounded-lg flex items-center justify-center\">\n                      <Eye className=\"h-8 w-8 text-gray-400\" />\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              <div>\n                <h4 className=\"font-semibold text-gray-900 mb-3\">Review Notes (Optional)</h4>\n                <Textarea \n                  placeholder=\"Add any feedback or notes for the influencer...\"\n                  value={reviewNotes}\n                  onChange={(e) => setReviewNotes(e.target.value)}\n                  rows={3}\n                />\n              </div>\n\n              <div className=\"flex gap-4\">\n                <Button \n                  onClick={() => handleApprove(selectedSubmission.id)}\n                  className=\"flex-1 bg-green-600 hover:bg-green-700 text-white\"\n                >\n                  <CheckCircle className=\"h-4 w-4 mr-2\" />\n                  Approve & Process Payment\n                </Button>\n                <Button \n                  onClick={() => handleReject(selectedSubmission.id)}\n                  variant=\"outline\"\n                  className=\"flex-1 border-red-200 text-red-600 hover:bg-red-50\"\n                >\n                  <X className=\"h-4 w-4 mr-2\" />\n                  Reject Submission\n                </Button>\n                <Button \n                  variant=\"outline\" \n                  onClick={() => {\n                    setSelectedSubmission(null);\n                    setReviewNotes('');\n                  }}\n                >\n                  Cancel\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n    </div>\n  );\n}